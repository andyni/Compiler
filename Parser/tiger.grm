%%
%term
    EOF 
  | ID of string
  | INT of int | STRING of string 
  | COMMA | COLON | SEMICOLON | LPAREN | RPAREN | LBRACK | RBRACK 
  | LBRACE | RBRACE | DOT 
  | PLUS | MINUS | TIMES | DIVIDE | EQ | NEQ | LT | LE | GT | GE
  | AND | OR | ASSIGN
  | ARRAY | IF | THEN | ELSE | WHILE | FOR | TO | DO | LET | IN | END | OF 
  | BREAK | NIL
  | FUNCTION | VAR | TYPE 

%nonterm  exp | program | decs | dec | sequence | funlist | intexp | ifstmt
 | compexp | boolop | comptype | tydec | ty | record | recordlist |
 tyfields | vardec | fundec | lvalue | evalsequence

%pos int
%verbose
%start program
%eop EOF
%noshift EOF

%name Tiger

%keyword WHILE FOR TO BREAK LET IN END FUNCTION VAR TYPE ARRAY IF THEN ELSE 
	DO OF NIL

%prefer THEN ELSE LPAREN

%value ID ("bogus")
%value INT (1)
%value STRING ("")

%nonassoc ID THEN
%left PLUS MINUS
%left TIMES DIVIDE
%right LBRACK COMMA ELSE


%%

program	: exp ()
	
exp: lvalue ()
   | NIL ()
   | LPAREN evalsequence RPAREN ()
   | intexp ()
   | STRING ()
   | ID LPAREN funlist RPAREN ()
   | boolop ()
   | record ()
   | ID LBRACK exp RBRACK OF exp ()
   | lvalue ASSIGN exp ()
   | WHILE compexp DO exp ()
   | FOR ID ASSIGN exp TO exp DO exp ()
   | BREAK ()
   | LET decs IN sequence END ()
   | LPAREN exp RPAREN () 
   | IF compexp THEN exp ()
   | IF compexp THEN exp ELSE exp ()

decs : dec dec ()
     | () 

dec : tydec ()
     | vardec ()
     | fundec ()

sequence : exp ()
         | sequence SEMICOLON exp ()
         | ()

evalsequence : exp SEMICOLON exp ()
             | evalsequence SEMICOLON exp()

funlist : exp () 
         | exp COMMA exp ()
         | ()

intexp : intexp PLUS intexp ()
	 | intexp MINUS intexp ()
	 | intexp TIMES intexp ()
	 | intexp DIVIDE intexp ()       
         | MINUS intexp ()
	 | INT ()

compexp : comptype EQ comptype ()
	 | comptype NEQ comptype ()
	 | comptype LE comptype ()
	 | comptype LT comptype ()
	 | comptype GE comptype ()
	 | comptype GT comptype ()
         | ID EQ ID ()
	 | ID NEQ ID ()
         | intexp ()

boolop : compexp AND compexp ()
	 | compexp OR compexp ()

comptype : STRING ()
	 | intexp ()

tydec : TYPE ID EQ ty () 

ty : ID ()
   | LBRACE tyfields RBRACE () 
   | ARRAY OF ID ()

record : ID LBRACE recordlist RBRACE ()

recordlist : ID EQ exp ()
           | recordlist COMMA recordlist ()
           | ()

tyfields : ID COLON ID () 
         | ID COLON ID COMMA tyfields ()
         | ()

vardec : VAR ID ASSIGN exp ()
       | VAR ID COLON ID ASSIGN exp ()

fundec : FUNCTION ID LPAREN tyfields RPAREN EQ exp ()
       | FUNCTION ID LPAREN tyfields RPAREN COLON ID EQ exp ()

lvalue : ID ()
       | lvalue DOT ID ()
       | lvalue LBRACK exp RBRACK ()  
